CATARSE.LayoutsApplicationView=Backbone.View.extend({initialize:function(){this.dropDownOpened=!1,_.bindAll(this,"render","flash","openLogin","closeLogin","submitLogin","currentUserDropDown"),CATARSE.router.route("login/*url","login_with_url",this.openLogin),CATARSE.router.route("login","login",this.openLogin),this.render()},events:{"submit .search":"search","hidden #myModal":"removeBackdrop","click #login .close":"closeLogin","click #login a.provider":"submitLogin","click a.my_profile_link":"currentUserDropDown","focus .form_login.bootstrap-form input":"markLoginForm","focus .form_register.bootstrap-form input":"markRegisterForm"},markRegisterForm:function(a){rootElement=$(a.currentTarget).closest(".bootstrap-form"),rootElement.hasClass("actived")||($(".bootstrap-form").removeClass("actived"),rootElement.addClass("actived"))},markLoginForm:function(a){rootElement=$(a.currentTarget).closest(".bootstrap-form"),rootElement.hasClass("actived")||($(".bootstrap-form").removeClass("actived"),rootElement.addClass("actived"))},openLogin:function(a){var b=null;typeof a!="undefined"?b=a:b=CATARSE.router.lastPath(),this.$("#login #return_to").val(b),this.$("#login_overlay").show(),this.$("#login").fadeIn()},closeLogin:function(a){this.$("#login #return_to").val(null),this.$("#login").hide(),this.$("#login_overlay").hide()},showModal:function(a){target=$(a.target).attr("data-target"),url=$(a.target).attr("href"),$(target).load(url),$(target).show()},removeBackdrop:function(a){this.$(".modal-backdrop").remove()},submitLogin:function(a){a.preventDefault();var b=$(a.target);b.is("a")||(b=b.parent());if(b.hasClass("disabled"))return!1;this.$("#login a.provider").addClass("disabled"),this.$("#login #provider").val(b.attr("href")),this.$("#login form").submit()},search:function(a){var b=this.$(a.target).find("#search").val();return($("#main_content").data("controller-name")!="explore"||$("#main_content").data("action")!="index")&&b.length>0&&(location.href="/explore#search/"+b),!1},flash:function(){setTimeout(function(){this.$(".flash").slideDown("slow")},100),this.$(".flash a").length||setTimeout(function(){this.$(".flash").slideUp("slow")},16e3),$(window).click(function(){this.$(".flash").slideUp()})},currentUserDropDown:function(a){a.preventDefault(),$dropdown=this.$(".dropdown.user"),this.dropDownOpened?(this.dropDownOpened=!1,$dropdown.hide()):($dropdown.show(),this.dropDownOpened=!0)},newsletterModal:function(){$("#newsletterModal").modal()},render:function(){this.flash(),this.newsletterModal()}})